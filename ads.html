<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Posted Ads</title>
  <link href="./ads.css" rel="stylesheet">
</head>

<body>
  
  <div class="container" id="ads-container"></div>
  <script>
    window.onload = async function() {
      const adsContainer = document.getElementById("ads-container");

      try {
        const response = await fetch("http://localhost:3000/ads");
        const ads = await response.json();

        ads.forEach(ad => {
          const adElement = document.createElement("div");
          adElement.classList.add("ad");
          adElement.innerHTML = `
            <img src="${ad.imagePath}" alt="${ad.itemType}">
            <h2>Item Type: ${ad.itemType}</h2>
            <p>Condition: ${ad.condition}</p>
            <button class="view-details-btn">View Details</button>
            
            
            <div class="details" style="display: none;">
              <p>Posted By: ${ad.fullname}</p>
              <p>Quantity: ${ad.quantity}</p>
              <p>Description: ${ad.description}</p>
              
            <div class="contact-details" style="display: none;">
              <p>Email: ${ad.email}</p>
              <p>Account: ${ad.account}</p>
              <p>UPI: ${ad.upi}</p>
            </div>
            
            <button class="view-contact-btn" style="display: none;">View Contact Details</button>
              <button class="view-location-btn" data-location="${ad.location}">View Location</button>
            </div>
            
          `;
          adsContainer.appendChild(adElement);

          // Add event listener to the "View Details" button
          const viewDetailsBtn = adElement.querySelector(".view-details-btn");
          viewDetailsBtn.addEventListener("click", function() {
            const details = adElement.querySelector(".details");
            const viewContactBtn = adElement.querySelector(".view-contact-btn");
            if (details.style.display === "none") {
              details.style.display = "block";
              viewContactBtn.style.display = "block";
              viewDetailsBtn.textContent = "Hide Details";
            } else {
              details.style.display = "none";
              viewContactBtn.style.display = "none";
              viewDetailsBtn.textContent = "View Details";
            }
          });

          // Add event listener to the "View Location" button
          const viewLocationBtn = adElement.querySelector(".view-location-btn");
          viewLocationBtn.addEventListener("click", function() {
            const location = viewLocationBtn.getAttribute("data-location");
            const [latitude, longitude] = location.split(",");
            if (latitude && longitude) {
              window.open(`https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`, "_blank");
            } else {
              console.error("Latitude and/or longitude undefined");
            }
          });

          // Add event listener to the "View Contact Details" button
          const viewContactBtn = adElement.querySelector(".view-contact-btn");
          viewContactBtn.addEventListener("click", function() {
            const contactDetails = adElement.querySelector(".contact-details");
            if (contactDetails.style.display === "none") {
              contactDetails.style.display = "block";
              viewContactBtn.textContent = "Hide Contact Details";
            } else {
              contactDetails.style.display = "none";
              viewContactBtn.textContent = "View Contact Details";
            }
          });
        });
      } catch (error) {
        console.error("Error fetching ads:", error);
        adsContainer.innerHTML = "<p>Error fetching ads</p>";
      }
    };

  </script>
</body>
</html>
